# Proto Gear v0.8.0 - Composition Engine Kickoff

**Created**: 2025-12-09
**Status**: Planning Phase
**Target Release**: v0.8.0 (2-3 months, no rush)
**Priority**: Next Major Feature

---

## üéØ Vision

Enable users to **compose custom AI sub-agents** by selecting and combining capabilities from Proto Gear's modular system. Instead of working with generic templates, users can create specialized agents (Testing Agent, Deployment Agent, Review Agent, etc.) tailored to specific tasks.

**Core Principle**: Capabilities are building blocks. Sub-agents are compositions of these blocks.

---

## üìã Current State (v0.7.3)

### What We Have
- **14 capabilities** across 4 categories:
  - 4 Skills (testing, debugging, code-review, refactoring)
  - 5 Workflows (feature-development, bug-fix, hotfix, release, finalize)
  - 1 Command (create-ticket)
  - (Agents category placeholder for future)
- **8 core templates** with cross-reference network
- **Capability discovery system** (.proto-gear/INDEX.md)
- **Template metadata system** (YAML frontmatter)

### What's Missing
- ‚ùå No way to compose custom agents from capabilities
- ‚ùå No dependency resolution between capabilities
- ‚ùå No conflict detection
- ‚ùå No agent configuration format
- ‚ùå No CLI for capability management
- ‚ùå No validation system for composed agents

---

## üöÄ Goals for v0.8.0

### Primary Goals

1. **Sub-Agent Builder Wizard**
   - Interactive CLI wizard for composing agents
   - Select capabilities by category
   - Preview composed agent
   - Generate agent configuration files

2. **Composition Engine**
   - Dependency resolution (auto-include required capabilities)
   - Conflict detection (warn about incompatibilities)
   - Context optimization (load only needed capabilities)
   - Validation (ensure composed agent is viable)

3. **Agent Configuration System**
   - YAML-based agent definitions
   - Custom context priority rules
   - Agent-specific instructions
   - Capability composition metadata

### Secondary Goals

4. **Enhanced Capability Management**
   - `pg capabilities list` - Show all available capabilities
   - `pg capabilities search <query>` - Search by name/tag
   - `pg capabilities show <name>` - Show capability details
   - `pg capabilities add <name>` - Install specific capability

5. **Documentation & Examples**
   - Example agent configurations (testing-agent, deployment-agent, etc.)
   - User guide for sub-agent builder
   - Developer guide for creating capabilities

---

## üèóÔ∏è Architecture Design

### 1. Agent Configuration Format

**Location**: `.proto-gear/agents/<agent-name>.yaml`

**Structure**:
```yaml
# .proto-gear/agents/my-testing-agent.yaml
name: "Testing Agent"
version: "1.0.0"
description: "Specialized agent for TDD and test automation"

capabilities:
  skills:
    - testing/tdd
    - debugging/systematic
    - code-review/testing-focus

  workflows:
    - bug-fix
    - feature-development

  commands:
    - create-ticket
    - update-status  # Future command

context_priority:
  # What the agent should prioritize when reading files
  - "Read test files first"
  - "Check coverage reports"
  - "Review recent test failures"
  - "Examine PROJECT_STATUS.md for active bugs"

agent_instructions:
  # Custom instructions specific to this agent
  - "Always follow TDD: write tests before implementation"
  - "Aim for 80%+ test coverage"
  - "Run tests after every change"
  - "Update TESTING.md with new patterns discovered"

required_files:
  # Files that must exist for this agent to function
  - "TESTING.md"
  - "PROJECT_STATUS.md"

optional_files:
  # Files the agent will use if available
  - "BRANCHING.md"
  - ".proto-gear/INDEX.md"
```

### 2. Capability Metadata Enhancement

Add metadata to each capability for composition:

```yaml
# .proto-gear/skills/testing/metadata.yaml
name: "TDD Methodology"
version: "1.0.0"
category: "skill"
tags: ["testing", "tdd", "quality", "best-practices"]

dependencies:
  required: []
  optional:
    - "workflows/bug-fix"
    - "workflows/feature-development"

conflicts:
  # Capabilities that conflict with this one
  - "skills/cowboy-coding"  # Hypothetical example

composable_with:
  # Capabilities that work well together
  - "workflows/bug-fix"
  - "workflows/feature-development"
  - "skills/debugging"
  - "skills/code-review"

ai_agent_roles:
  # Which agent types benefit from this capability
  - "Testing Agent"
  - "Quality Assurance Agent"
  - "Full-Stack Developer Agent"

description: |
  Test-Driven Development methodology with Red-Green-Refactor cycle.
  Includes test pyramid, coverage targets, and best practices.

usage_notes: |
  This capability works best when combined with a testing workflow
  and debugging skills. Ensure TESTING.md exists in the project.
```

### 3. Composition Engine Components

**Core Components**:

1. **Dependency Resolver**
   - Analyze agent configuration
   - Identify required capabilities
   - Auto-include dependencies
   - Build dependency graph

2. **Conflict Detector**
   - Check for conflicting capabilities
   - Warn user before composition
   - Suggest resolution strategies

3. **Context Optimizer**
   - Determine which capabilities are needed for a task
   - Load only relevant capabilities
   - Reduce context bloat

4. **Validator**
   - Ensure all required files exist
   - Check capability compatibility
   - Verify agent configuration is valid

### 4. CLI Commands

```bash
# Sub-agent management
pg agent create <name>          # Launch sub-agent builder wizard
pg agent list                   # Show all configured agents
pg agent show <name>            # Show agent configuration
pg agent validate <name>        # Validate agent configuration
pg agent delete <name>          # Remove agent configuration

# Capability management
pg capabilities list             # Show all available capabilities
pg capabilities search <query>   # Search capabilities
pg capabilities show <name>      # Show capability details
pg capabilities add <name>       # Add specific capability
pg capabilities remove <name>    # Remove capability
pg capabilities update           # Update all capabilities
```

---

## üìù Implementation Plan

### Phase 1: Foundation (Week 1-2)

**Goal**: Set up basic infrastructure

**Tasks**:
1. Create `capabilities/metadata.yaml` schema
2. Add metadata to existing 14 capabilities
3. Create `agents/` directory structure
4. Define agent configuration schema
5. Write schema validation logic

**Deliverables**:
- [ ] Metadata schema documented
- [ ] All 14 capabilities have metadata.yaml
- [ ] Agent configuration schema defined
- [ ] Validation functions implemented

### Phase 2: Composition Engine (Week 3-4)

**Goal**: Build core composition logic

**Tasks**:
1. Implement dependency resolver
2. Implement conflict detector
3. Implement context optimizer
4. Implement agent validator
5. Write comprehensive tests

**Deliverables**:
- [ ] Dependency resolution working
- [ ] Conflict detection working
- [ ] Context optimization working
- [ ] Agent validation working
- [ ] 80%+ test coverage for engine

### Phase 3: CLI & Wizard (Week 5-6)

**Goal**: Create user-facing tools

**Tasks**:
1. Implement `pg agent create` wizard
2. Implement `pg capabilities *` commands
3. Create interactive agent builder
4. Add preview/validation in wizard
5. Write integration tests

**Deliverables**:
- [ ] Sub-agent builder wizard functional
- [ ] Capability management commands working
- [ ] Beautiful UI with rich/questionary
- [ ] Integration tests passing

### Phase 4: Examples & Documentation (Week 7-8)

**Goal**: Create examples and guides

**Tasks**:
1. Create 5 example agent configurations
   - Testing Agent
   - Deployment Agent
   - Code Review Agent
   - Security Agent
   - Documentation Agent
2. Write user guide for sub-agent builder
3. Write developer guide for capability creation
4. Update CHANGELOG.md
5. Update readiness assessment

**Deliverables**:
- [ ] 5 example agents created
- [ ] User guide complete
- [ ] Developer guide complete
- [ ] All documentation updated

---

## üß™ Testing Strategy

### Unit Tests

**Coverage targets**: 80%+

**Test Categories**:
1. Metadata parsing and validation
2. Dependency resolution algorithms
3. Conflict detection logic
4. Context optimization
5. Agent configuration validation

### Integration Tests

**Test Scenarios**:
1. Create agent via wizard ‚Üí validate ‚Üí load capabilities
2. Detect conflicts ‚Üí resolve ‚Üí create agent
3. Agent with dependencies ‚Üí auto-include ‚Üí validate
4. Invalid agent config ‚Üí show errors ‚Üí prevent creation

### Manual Testing

**Test Cases**:
1. Create testing agent with wizard
2. Create deployment agent
3. Try to create agent with conflicting capabilities
4. Create agent with missing dependencies
5. Validate agent with invalid configuration

---

## ‚úÖ Success Criteria

### Must Have (v0.8.0)

- ‚úÖ Users can create custom agents via interactive wizard
- ‚úÖ Dependency resolution works automatically
- ‚úÖ Conflict detection warns users
- ‚úÖ Agent configurations are YAML-based
- ‚úÖ At least 5 example agents provided
- ‚úÖ User guide for sub-agent builder exists
- ‚úÖ 80%+ test coverage for composition engine

### Nice to Have (v0.8.x)

- ‚≠ê Agent templates (pre-configured agents for common tasks)
- ‚≠ê Capability recommendations based on project type
- ‚≠ê Agent marketplace/sharing (future v1.5.0+)
- ‚≠ê Visual agent builder (web UI)

### Won't Have (Deferred)

- ‚ùå Runtime agent switching (too complex)
- ‚ùå Agent inheritance (YAML would get messy)
- ‚ùå Dynamic capability loading (not needed yet)

---

## ü§î Open Questions

### Technical Questions

1. **Q**: Should agents be able to extend other agents?
   **A**: Defer to v0.9.0 - YAML inheritance is complex

2. **Q**: How do we handle capability version conflicts?
   **A**: Start simple - all capabilities use same version (package version)

3. **Q**: Should context optimization be automatic or manual?
   **A**: Automatic for v0.8.0 - simplicity first

4. **Q**: Do we need an agent registry or just file-based?
   **A**: File-based for v0.8.0 - registry for v1.0.0+

### Design Questions

5. **Q**: Should the wizard support editing existing agents?
   **A**: Yes - add `pg agent edit <name>` command

6. **Q**: How do users share agent configurations?
   **A**: Copy .yaml files for v0.8.0 - marketplace for v1.5.0+

7. **Q**: Should agents have runtime context (state)?
   **A**: No - agents are just capability compositions, not stateful

---

## üìö Resources & References

### Existing Code to Review

1. `core/proto_gear_pkg/interactive_wizard.py` - Wizard patterns
2. `core/proto_gear_pkg/proto_gear.py` - Template generation
3. `.proto-gear/INDEX.md` - Capability discovery pattern
4. `docs/dev/capabilities-roadmap.md` - Original vision
5. `docs/dev/template-metadata-schema.md` - Metadata patterns

### Similar Projects (for inspiration)

1. **Docker Compose** - Multi-component configuration
2. **Ansible Playbooks** - Task composition and dependencies
3. **VS Code Extensions** - Modular capabilities
4. **GitHub Actions** - Workflow composition

---

## üé¨ Getting Started (For Next Session)

### For AI Agents

1. **Read this document completely** - Understand vision and architecture
2. **Review existing capabilities** - See `.proto-gear/` directory
3. **Check current metadata** - None exists yet, need to create
4. **Start with Phase 1** - Create metadata schema and add to capabilities

### Suggested First Tasks

**PROTO-026**: Create capability metadata system
- Create metadata.yaml schema
- Add metadata to 14 existing capabilities
- Write validation logic
- Add tests

**PROTO-027**: Design agent configuration schema
- Define YAML structure for agents
- Create example agent configs
- Write validation logic
- Document schema

**PROTO-028**: Implement composition engine core
- Dependency resolver
- Conflict detector
- Agent validator
- Tests

---

## üìä Estimated Effort

**Total Effort**: 60-80 hours
**Timeline**: 2-3 months (no rush, quality first)
**Team Size**: 1-2 developers (or AI agents)

**Breakdown**:
- Phase 1 (Foundation): 15-20 hours
- Phase 2 (Engine): 20-25 hours
- Phase 3 (CLI/Wizard): 15-20 hours
- Phase 4 (Docs/Examples): 10-15 hours

---

## üéØ Success Metrics

**v0.8.0 will be successful if**:

1. Users can create a custom testing agent in < 5 minutes
2. Dependency resolution works 100% of the time
3. Conflict detection catches all incompatibilities
4. Documentation is clear enough for non-technical users
5. Example agents cover 80% of common use cases
6. Test coverage is 80%+ for composition engine
7. No breaking changes to existing templates or capabilities

---

## üí° Notes for Future

**Ideas to explore later** (v0.9.0+):

- Agent templates (pre-built agents for common scenarios)
- Capability recommendations based on project type
- Agent performance analytics (which agents are most effective)
- Community agent marketplace
- Agent versioning and updates
- Multi-agent coordination patterns

---

*Created: 2025-12-09*
*For: Proto Gear v0.8.0 Development*
*Status: Ready for implementation*
