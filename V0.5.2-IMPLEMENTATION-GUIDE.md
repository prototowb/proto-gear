# v0.5.2 Implementation Guide - Template Generation Fix

**Context**: v0.5.0 and v0.5.1 have templates in the package that don't generate because they're not wired into the CLI.

**Solution**: Add `--all` flag to generate all available templates.

---

## Files to Edit

### 1. `core/proto_gear_pkg/proto_gear.py`

#### Change 1: Add CLI Flag (after line 1039)

Insert this code after the `--with-capabilities` argument:

```python
    init_parser.add_argument(
        '--all',
        action='store_true',
        help='Generate ALL available project templates (TESTING, BRANCHING, CONTRIBUTING, SECURITY, ARCHITECTURE, CODE_OF_CONDUCT)'
    )
```

#### Change 2: Update `run_simple_protogear_init()` Signature (line ~957)

Find:
```python
def run_simple_protogear_init(dry_run=False, with_branching=False, ticket_prefix=None, with_capabilities=False, capabilities_config=None):
```

Change to:
```python
def run_simple_protogear_init(dry_run=False, with_branching=False, ticket_prefix=None, with_capabilities=False, capabilities_config=None, with_all=False):
```

#### Change 3: Update CLI invocation (line ~1100)

Find:
```python
                result = run_simple_protogear_init(
                    dry_run=args.dry_run,
                    with_branching=args.with_branching,
                    ticket_prefix=args.ticket_prefix,
                    with_capabilities=args.with_capabilities
                )
```

Change to:
```python
                result = run_simple_protogear_init(
                    dry_run=args.dry_run,
                    with_branching=args.with_branching,
                    ticket_prefix=args.ticket_prefix,
                    with_capabilities=args.with_capabilities,
                    with_all=args.all if hasattr(args, 'all') else False
                )
```

#### Change 4: Update wizard invocation (line ~1088)

Find:
```python
                    result = run_simple_protogear_init(
                        dry_run=args.dry_run,
                        with_branching=wizard_config.get('with_branching', False),
                        ticket_prefix=wizard_config.get('ticket_prefix'),
                        with_capabilities=wizard_config.get('with_capabilities', False),
                        capabilities_config=wizard_config.get('capabilities_config')
                    )
```

Change to:
```python
                    result = run_simple_protogear_init(
                        dry_run=args.dry_run,
                        with_branching=wizard_config.get('with_branching', False),
                        ticket_prefix=wizard_config.get('ticket_prefix'),
                        with_capabilities=wizard_config.get('with_capabilities', False),
                        capabilities_config=wizard_config.get('capabilities_config'),
                        with_all=args.all if hasattr(args, 'all') else False
                    )
```

#### Change 5: Update `setup_agent_framework_only()` Signature (line 616)

Find:
```python
def setup_agent_framework_only(dry_run=False, with_branching=False, ticket_prefix=None, with_capabilities=False, capabilities_config=None):
```

Change to:
```python
def setup_agent_framework_only(dry_run=False, with_branching=False, ticket_prefix=None, with_capabilities=False, capabilities_config=None, with_all=False):
```

#### Change 6: Add Template Generation Function (after line 456, before `def copy_capability_templates`)

```python
def generate_project_template(template_name, project_dir, context):
    """
    Generate a project template from the template file.

    Args:
        template_name: Name of the template (e.g., 'TESTING', 'CONTRIBUTING')
        project_dir: Path to project directory
        context: Dictionary with placeholder values

    Returns:
        Path to created file or None if failed
    """
    try:
        # Get template file from package
        template_file = Path(__file__).parent / f"{template_name}.template.md"

        if not template_file.exists():
            print(f"Warning: Template {template_name}.template.md not found")
            return None

        # Read template content
        content = template_file.read_text(encoding='utf-8')

        # Replace placeholders
        for key, value in context.items():
            placeholder = f"{{{{{key}}}}}"
            content = content.replace(placeholder, str(value))

        # Write to project directory
        output_file = project_dir / f"{template_name}.md"
        output_file.write_text(content, encoding='utf-8')

        return output_file

    except Exception as e:
        print(f"Error generating {template_name}: {e}")
        return None
```

#### Change 7: Call Template Generation (in `setup_agent_framework_only()`, after line 762, before capabilities generation)

Add this code after PROJECT_STATUS.md generation:

```python
            # Generate additional templates if --all flag is used
            if with_all or with_branching:  # with_branching for backward compat
                template_context = {
                    'PROJECT_NAME': current_dir.name,
                    'TICKET_PREFIX': ticket_prefix,
                    'DATE': datetime.now().strftime('%Y-%m-%d'),
                    'YEAR': datetime.now().strftime('%Y')
                }

                # List of templates to generate
                templates_to_generate = ['TESTING']

                if with_all:
                    templates_to_generate.extend([
                        'BRANCHING',
                        'CONTRIBUTING',
                        'SECURITY',
                        'ARCHITECTURE',
                        'CODE_OF_CONDUCT'
                    ])
                elif with_branching:
                    # Old behavior: only BRANCHING
                    templates_to_generate.append('BRANCHING')

                for template_name in templates_to_generate:
                    if template_name == 'BRANCHING' and not with_all:
                        # Skip - already handled by generate_branching_doc()
                        continue

                    output_file = generate_project_template(
                        template_name,
                        current_dir,
                        template_context
                    )

                    if output_file:
                        files_created.append(f"{template_name}.md")
```

---

## Testing

### Test 1: Dry Run with --all
```bash
pg init --all --dry-run
```

**Expected output**: Should list all 8 templates:
- AGENTS.md
- PROJECT_STATUS.md
- TESTING.md
- BRANCHING.md
- CONTRIBUTING.md
- SECURITY.md
- ARCHITECTURE.md
- CODE_OF_CONDUCT.md

### Test 2: Actual Generation
```bash
cd /tmp/test-project
pg init --all
```

**Expected**: All 8 .md files created

### Test 3: Backward Compatibility
```bash
pg init --with-branching
```

**Expected**: AGENTS.md, PROJECT_STATUS.md, BRANCHING.md (old behavior preserved)

### Test 4: Help Text
```bash
pg init --help
```

**Expected**: Should show `--all` flag in help output

---

## Commit and Release

### 1. Commit Changes
```bash
git add core/proto_gear_pkg/proto_gear.py
git commit -m "feat(cli): add --all flag to generate all project templates

Fixes issue where v0.5.0 templates existed but weren't accessible.

New flag:
- --all: Generates ALL templates (TESTING, BRANCHING, CONTRIBUTING,
  SECURITY, ARCHITECTURE, CODE_OF_CONDUCT) in addition to AGENTS and PROJECT_STATUS

This makes all v0.5.0 templates immediately usable without manual integration.

Resolves: Template integration gap from v0.5.0/v0.5.1
Related: PROTO-023 (full auto-discovery planned for v0.6.0)"
```

### 2. Update Version

Edit `pyproject.toml`:
```toml
version = "0.5.2"
```

Update version in `core/proto_gear_pkg/proto_gear.py`:
- Line 45: `v0.5.1` → `v0.5.2`
- Line 94: `v0.5.1` → `v0.5.2`
- Line 458: `"0.5.1"` → `"0.5.2"`
- Line 720: `v0.5.0` → `v0.5.2`

### 3. Update CHANGELOG.md

Add entry:
```markdown
## [0.5.2] - 2025-11-09

### Added
- `--all` flag to generate all available project templates
- Generic `generate_project_template()` function for template generation

### Fixed
- v0.5.0/v0.5.1 templates (CONTRIBUTING, SECURITY, ARCHITECTURE, CODE_OF_CONDUCT) now accessible via `--all` flag
- Template generation no longer requires manual CLI integration

### Changed
- Improved template generation to support all 8 templates
- Backward compatible with existing `--with-branching` flag
```

### 4. Tag and Push
```bash
git add pyproject.toml core/proto_gear_pkg/proto_gear.py CHANGELOG.md
git commit -m "chore(release): bump version to 0.5.2

Patch release adding --all flag for complete template generation.

All v0.5.0 templates now accessible!"

git tag -a v0.5.2 -m "Release v0.5.2 - Complete Template Access

Quick fix for template availability issue.

New Feature:
- --all flag generates all 8 templates

This resolves the v0.5.0/v0.5.1 issue where templates existed
but weren't generated.

Usage: pg init --all"

git push origin main
git push origin v0.5.2
```

---

## Expected Outcome

After implementing this:
1. Users can run `pg init --all` to get all templates
2. All v0.5.0 features are now accessible
3. Backward compatible with existing flags
4. Sets foundation for PROTO-023 (auto-discovery in v0.6.0)

---

## Time Estimate

- Implementation: 45-60 minutes
- Testing: 15 minutes
- Release process: 15 minutes
- **Total**: ~90 minutes

---

**Next**: After v0.5.2 is released, implement PROTO-023 for full auto-discovery in v0.6.0.
